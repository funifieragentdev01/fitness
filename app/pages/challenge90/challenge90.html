<div id="challenge90" class="screen">
    <div class="screen-header">
        <button class="btn-back" ng-click="goTo('dashboard')"><i class="fas fa-arrow-left"></i></button>
        <h2>ğŸ† Desafio 90 Dias</h2>
    </div>
    <div class="screen-body">
        <!-- Status Card -->
        <div class="challenge90-status-card">
            <div class="challenge90-big-day">Dia {{challenge90.currentDay || 1}}<span>/90</span></div>
            <div class="progress-bar" style="margin:16px 0">
                <div class="progress-fill challenge90-fill" ng-style="{'width': ((challenge90.currentDay || 1) / 90 * 100) + '%'}"></div>
            </div>
            <div class="challenge90-dates">
                <span>InÃ­cio: {{formatDate(challenge90.startDate)}}</span>
                <span>Fim: {{formatDate(challenge90.endDate)}}</span>
            </div>
        </div>

        <!-- First Check-in CTA -->
        <div ng-show="challenge90.checkpoints && challenge90.checkpoints[0] && !challenge90.checkpoints[0].done" style="text-align:center;margin:20px 0;padding:24px;background:rgba(255,107,0,0.1);border:1px solid rgba(255,107,0,0.3);border-radius:var(--radius)">
            <div style="font-size:36px;margin-bottom:8px">ğŸ“¸</div>
            <h3 style="margin-bottom:8px">Registre seu ponto de partida!</h3>
            <p style="color:var(--text-muted);font-size:14px;margin-bottom:16px">Tire sua foto de frente e lateral para acompanhar sua transformaÃ§Ã£o.</p>
            <button class="btn btn-primary" ng-click="goToCheckin()">Fazer Check-in Corporal ğŸ“¸</button>
        </div>

        <!-- Before/After Photos -->
        <div ng-show="firstPhoto || lastPhoto" style="margin-top:20px">
            <h3 class="section-title">ğŸ“¸ Sua TransformaÃ§Ã£o</h3>
            <div style="display:flex;gap:12px;justify-content:center">
                <div style="text-align:center" ng-show="firstPhoto">
                    <img ng-src="{{firstPhoto}}" style="width:120px;height:160px;object-fit:cover;border-radius:8px;border:2px solid var(--accent)">
                    <div style="font-size:12px;color:var(--text-muted);margin-top:4px">Dia 1</div>
                </div>
                <div style="text-align:center" ng-show="lastPhoto">
                    <img ng-src="{{lastPhoto}}" style="width:120px;height:160px;object-fit:cover;border-radius:8px;border:2px solid var(--accent)">
                    <div style="font-size:12px;color:var(--text-muted);margin-top:4px">Ãšltimo</div>
                </div>
            </div>
        </div>

        <!-- Checkpoints -->
        <h3 class="section-title" style="margin-top:20px">ğŸ“¸ Checkpoints de Fotos</h3>
        <div class="checkpoint-timeline">
            <div class="checkpoint-item" ng-repeat="cp in challenge90.checkpoints" ng-class="{'done': cp.done, 'current': cp.current}">
                <div class="checkpoint-marker">
                    <i class="fas" ng-class="cp.done ? 'fa-check-circle' : 'fa-circle'"></i>
                </div>
                <div class="checkpoint-info">
                    <span class="checkpoint-day">Dia {{cp.day}}</span>
                    <span class="checkpoint-status" ng-show="cp.done">âœ… Registrado</span>
                    <span class="checkpoint-status" ng-show="cp.current && !cp.done">ğŸ“¸ Hora de tirar foto!</span>
                    <span class="checkpoint-status" ng-show="!cp.done && !cp.current">Pendente</span>
                </div>
                <div ng-show="cp.photos && cp.photos.front" style="display:flex;gap:4px">
                    <img ng-src="{{cp.photos.front}}" style="width:36px;height:36px;object-fit:cover;border-radius:4px">
                </div>
                <button class="btn btn-sm btn-primary" ng-show="cp.current && !cp.done" ng-click="goToCheckin(cp.day)">Registrar</button>
            </div>
        </div>

        <!-- Weight Progress -->
        <h3 class="section-title" style="margin-top:20px">âš–ï¸ Progresso de Peso</h3>
        <div class="weight-list" ng-show="weightHistory.length">
            <div class="weight-entry" ng-repeat="w in weightHistory | limitTo:5">
                <span class="weight-date">{{w.date}}</span>
                <span class="weight-value">{{w.weight}} kg</span>
            </div>
        </div>
        <p ng-show="!weightHistory.length" class="empty-state">Nenhum registro de peso ainda.</p>

        <!-- Challenge Complete: Testimonial -->
        <div ng-show="challenge90.active" style="margin-top:24px;padding:24px;background:rgba(255,107,0,0.1);border:1px solid rgba(255,107,0,0.3);border-radius:var(--radius);text-align:center">
            <div style="font-size:48px;margin-bottom:12px">ğŸ‰</div>
            <h3 style="margin-bottom:8px">ParabÃ©ns! Desafio Completo!</h3>
            <p style="color:var(--text-muted);font-size:14px;margin-bottom:20px">Compartilhe sua experiÃªncia e inspire outros!</p>

            <div style="margin-bottom:16px">
                <label style="display:block;font-size:13px;color:var(--text-muted);margin-bottom:8px;text-align:left">Sua nota para o desafio:</label>
                <div style="display:flex;gap:8px;justify-content:center;font-size:32px;margin-bottom:16px">
                    <span ng-repeat="star in [1,2,3,4,5]" ng-click="testimonial.rating = star" ng-style="{'cursor':'pointer','opacity': star <= (testimonial.rating || 0) ? '1' : '0.3'}">â­</span>
                </div>
            </div>

            <div class="form-group" style="text-align:left">
                <label>Seu depoimento:</label>
                <textarea class="form-textarea" ng-model="testimonial.text" placeholder="Conte como foi sua experiÃªncia..." rows="4" style="width:100%;resize:vertical"></textarea>
            </div>

            <div class="form-group checkbox-group" style="margin-bottom:16px">
                <label><input type="checkbox" ng-model="testimonial.publishOnHome"> Publicar meu depoimento e fotos na pÃ¡gina inicial</label>
            </div>

            <button class="btn btn-primary btn-block" ng-click="submitTestimonial()" ng-disabled="!testimonial.text || !testimonial.rating || savingTestimonial || testimonialSaved">
                <span ng-if="!savingTestimonial && !testimonialSaved">Enviar Depoimento ğŸŒŸ</span>
                <span ng-if="savingTestimonial && !testimonialSaved"><i class="fas fa-spinner fa-spin"></i> Enviando...</span>
                <span ng-if="testimonialSaved">âœ… Depoimento enviado!</span>
            </button>
        </div>

        <!-- Share -->
        <div style="margin-top:24px" ng-show="challenge90.currentDay < 90">
            <h3 class="section-title">ğŸ‘¥ Convidar Amigos</h3>
            <p style="color:var(--text-muted);font-size:14px;margin-bottom:12px">Compartilhe o desafio e evolua junto!</p>
            <button class="btn btn-outline btn-block" ng-click="shareChallenge()">
                <i class="fas fa-share-alt"></i> Compartilhar Desafio
            </button>
        </div>

        <button class="btn btn-danger btn-block btn-sm" ng-click="quitChallenge90()" style="margin-top:24px" ng-show="challenge90.currentDay < 90">Desistir do desafio</button>
    </div>
</div>
